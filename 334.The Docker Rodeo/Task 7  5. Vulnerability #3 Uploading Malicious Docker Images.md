Continuing with exploiting the vulnerable Docker Registry from Task 3. "**Abusing a Docker Registry**", we can upload (or `push`) our own images to a repository, containing malicious code. Repositories can have as little or as many tags as the owners wish. However, every repository is guaranteed to have a "latest" tag. This tag is a copy of the latest upload of an image.

When a `docker pull` or `docker run` command is issued, Docker will first try to find a copy of the image (i.e. **cmnatic/myapp1**) on the host and then proceed to check if there have been any changes made on the Docker registry it was _pulled_ from. If there are changes, Docker will download the updated image onto the host and then proceed to execute.

Without proper authentication, we can upload our own image to the target's registry. That way, the next time the owner runs a`docker pull`or `docker run` command, their host will download and execute our malicious image as it will be a new version for Docker.

The screenshot below is a "Dockerfile" that uses the Docker `RUN` instruction to execute "netcat" within the container to connect to our machine! 

![](https://resources.cmnatic.co.uk/TryHackMe/rooms/docker-rodeo/malicious/reverseshell1.png)

We compile this into an image with `docker build`. Once compiled and added to the vulnerable registry, we set up a listener on our attacker machine and wait for the new image to be executed by the target.

![](https://resources.cmnatic.co.uk/TryHackMe/rooms/docker-rodeo/malicious/reverseshell2.png)

Note this will only grant us root access to the container using the image, and not the actual host - but it's a connection as root nonetheless. We can start to use these newly gained root privileges to look for configuration files, passwords or attempt to escape!

_Additional reading: [A Malicious DockerHub Image allowed attackers mine cryptocurrency](https://www.trendmicro.com/vinfo/us/security/news/virtualization-and-cloud/malicious-docker-hub-container-images-cryptocurrency-mining)_

---

Note that there is no practical element to this task by design.  

Answer the questions below

I've learnt that we can publish images with malicious code such as reverse shells to our vulnerable Docker registry.